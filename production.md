# _Production_
В этом файле описано создание build, залив проекта на сервер и его запуск.

#### 1. Создаём build папки client
Запустить в корне проекта команду:
##### `npm run client:build`

#### 2. О запуске сервера и подключении static на сервере
Сервер будет запускаться командой
#####`npm run start (cross-env NODE_ENV=production node app.js)`
Следовательно, сервер кроме api 
должен отдавать и статику, т.е. сам frontend. 
Эта логика реализована в файле app.js с помощью middleware 
`express.static()`

#### 3. Заливаем проект в GIT
Нужно создать новый репозиторий, куда выгрузить все исходники
Перед заливом убрать из `.gitignore` папку `images`, поскольку они нам нужны на сервере (это плохо, но пока сойдёт)

#### 4. Покупаем домен
Домен купить можно на сайте https://2domains.ru/

#### 5. Сливаем базу данных на удалённый сервер
Базу данных можно залить на https://freedb.tech/
1. Авторизуемся и создаём базу данных
2. Копируем в конфиг проект `connectionURI`
3. Создаём экспорт локальной базы данных в MySQL Workbench
4. Удаляем с файла дампа все `CREATE DEFINER` и заменяем кодировку `utf8mb4` на `utf8_general_ci`
5. Подключаемся к удалённой БД в MySQL Workbench и импортируем данные 
6. Всё готово, стоит проверить подключение к БД, запустив сервер на localhost, в консоли должно появиться соответствующее уведомление

#### 6. Создаём и настраиваем сервер
Хостинг можно устроить на https://vscale.io/
1. Создаём сервер
2. Задаём ему имя
3. Добавляем SSH ключ
4. Конфигурация сервера 1gb 30gb 1core Ubuntu 18 местоположение - Москва
5. Добавляем домен в разделе Домены
6. После запуска сервера запускаем Putty
7. Добавляем новое SSH соединение по ключу
8. Вводим ключевую фразу для своего ключа
9. Попадаем на сервер Ubuntu
10. Запускаем `sudo apt update`
11. Запускаем `sudo apt install git`
12. Проверяем `git --version`
13. Клонируем проект на сервер `git clone <repository>`
14. Устанавливаем curl `sudo apt -y install curl dirmngr apt-transport-https lsb-release ca-certificates`
15. Включаем репозиторий NodeSource `curl -sL https://deb.nodesource.com/setup_12.x | sudo -E bash -`
16. Устанавливаем node `sudo apt -y install nodejs`
17. Переходим в корень проекта
18. Запускаем `npm install`
19. Запускаем `npm run client:install`
20. Запускаем `npm run client:build`
21. Исправляем `config`. Перейти в папку config (`cd confgig`)
22. Открыть `nano production.json`
23. Port: `80`, host `<купленный домен, указанный на сервере>`, сохранить и выйти
24. Не забыть про шаг 5 выше
25. Устанавливаем `PM2` с помощью команды `sudo npm install -g pm2`
26. Запускаем процесс `pm2 start npm -- start`
27. Можем закрывать консоль
27. Чтобы остановить процесс: `pm2 stop <id>`